# Telegram LLM Bot

Telegram –±–æ—Ç —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Google Gemini AI –¥–ª—è –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π rate limiting –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ Supabase.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Gemini**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª–∏ Gemini 2.0 Flash Thinking (Pro) –∏ Gemini 2.0 Flash
- **üÜï RAG —Å–∏—Å—Ç–µ–º–∞**: –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º vector embeddings
- **üÜï –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã**: –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—à–ª—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- **üÜï –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: –ù–æ—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (03:00 MSK)
- **–£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤**: 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å –∫ Pro –º–æ–¥–µ–ª–∏, 25 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å –∫ Flash –º–æ–¥–µ–ª–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π**: –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Pro, –∑–∞—Ç–µ–º Flash
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Supabase**: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –ö–æ–º–∞–Ω–¥–∞ `/stats` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- **Graceful shutdown**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
- **Docker support**: –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –¥–µ–ø–ª–æ—è
- **Rate limiting –ø–æ —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É**: –õ–∏–º–∏—Ç—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ–ª–Ω–æ—á—å –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.21+ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- Docker –∏ Docker Compose (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
- Telegram Bot Token (–æ—Ç [@BotFather](https://t.me/BotFather))
- Google Gemini API Key (–æ—Ç [Google AI Studio](https://makersuite.google.com/app/apikey))
- Supabase –ø—Ä–æ–µ–∫—Ç (–æ—Ç [Supabase](https://supabase.com))

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone <repository-url>
cd telegram-llm-bot
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ Supabase

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Supabase](https://supabase.com)
2. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç—ã:

```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –±–æ—Ç–∞
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: deployments/supabase/schema.sql

-- RAG —Å–∏—Å—Ç–µ–º–∞ (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫)
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: deployments/supabase/rag_migration.sql
```

**–í–∞–∂–Ω–æ:** RAG —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è `pgvector`. –û–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `rag_migration.sql`.

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
nano .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```env
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
TELEGRAM_BOT_USERNAME=your_bot_username
TELEGRAM_ALLOWED_CHAT_IDS=-1001234567890,-1009876543210  # ID —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)

# Google Gemini API
GEMINI_API_KEY=your_gemini_api_key

# Supabase Configuration
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your_supabase_anon_or_service_key
```

#### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Chat ID –≥—Ä—É–ø–ø—ã:

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É (–∏–ª–∏ –≥—Ä—É–ø–ø—ã)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":-1001234567890}` - —ç—Ç–æ Chat ID –≥—Ä—É–ø–ø—ã
5. –î–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Ç–æ–≤ —É–∫–∞–∂–∏—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: `-1001234567890,-1009876543210`

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

#### –í–∞—Ä–∏–∞–Ω—Ç A: Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞
docker-compose down
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
go mod download

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
go run cmd/bot/main.go

# –ò–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
make build
./telegram-llm-bot
```

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` –∏–ª–∏ `/help` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
- `/stats` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `/sync` - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä—É—á–Ω—É—é –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è RAG (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)

### –ö–∞–∫ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å

–ü—Ä–æ—Å—Ç–æ —É–ø–æ–º—è–Ω–∏—Ç–µ –±–æ—Ç–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:

```
@your_bot_username —Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ Go —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
```

–ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç, –∏—Å–ø–æ–ª—å–∑—É—è –¥–æ—Å—Ç—É–ø–Ω—É—é –º–æ–¥–µ–ª—å (Pro –∏–ª–∏ Flash), –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö –ª–∏–º–∏—Ç–æ–≤.

### –ü—Ä–∏–º–µ—Ä—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @mybot —á—Ç–æ —Ç–∞–∫–æ–µ –∫–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞?
–ë–æ—Ç: [–æ—Ç–≤–µ—Ç –æ—Ç Gemini Pro]
     ü§ñ –ú–æ–¥–µ–ª—å: gemini-2.5-pro | –í—Ä–µ–º—è: 2500–º—Å

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /stats
–ë–æ—Ç: üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –ò–≤–∞–Ω
     
     ü§ñ Gemini Pro (Thinking):
        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 3/5
        –û—Å—Ç–∞–ª–æ—Å—å: 2
     
     ‚ö° Gemini Flash:
        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 0/25
        –û—Å—Ç–∞–ª–æ—Å—å: 25
     
     üìà –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 45
     ‚è∞ –°–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤ —á–µ—Ä–µ–∑: 8 —á.
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram-llm-bot/
‚îú‚îÄ‚îÄ cmd/bot/              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ bot/              # Telegram bot –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ llm/              # Gemini API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ models/           # –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ ratelimit/        # Rate limiting
‚îÇ   ‚îî‚îÄ‚îÄ storage/          # Supabase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ deployments/
‚îÇ   ‚îú‚îÄ‚îÄ docker/           # Docker —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ supabase/         # SQL —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Makefile
‚îî‚îÄ‚îÄ README.md
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ Make –∫–æ–º–∞–Ω–¥—ã

```bash
make help              # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
make build             # –°–æ–±—Ä–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–∏–∫
make run               # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
make test              # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make docker-build      # –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
make compose-up        # –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ docker-compose
make compose-logs      # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make compose-down      # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
```

## ü§ñ RAG –°–∏—Å—Ç–µ–º–∞

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RAG (Retrieval-Augmented Generation) –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —á–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
2. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: –ù–æ—á—å—é (03:00 MSK) —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
3. **–ü–æ–∏—Å–∫**: –ü—Ä–∏ –≤–æ–ø—Ä–æ—Å–µ –±–æ—Ç –∏—â–µ—Ç —Ç–æ–ø-5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
4. **–û—Ç–≤–µ—Ç**: LLM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –í —á–∞—Ç–µ —Å –±–æ—Ç–æ–º
/sync
```

–≠—Ç–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –î–∞–ª–µ–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π (–Ω–æ—á—å—é).

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–º. –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ [RAG_SETUP.md](RAG_SETUP.md)

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- `RAG_ENABLED=true` - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å RAG
- `RAG_TOP_K=5` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `RAG_SIMILARITY_THRESHOLD=0.8` - –ø–æ—Ä–æ–≥ similarity (0.0-1.0)

## üê≥ Docker

### –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑

```bash
docker build -t telegram-llm-bot .
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
docker run -d \
  --name telegram-llm-bot \
  --env-file .env \
  --restart unless-stopped \
  telegram-llm-bot
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏

```bash
docker logs -f telegram-llm-bot
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã Supabase

#### request_logs
–•—Ä–∞–Ω–∏—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–æ—Ç—É:
- ID, User ID, Username, First Name
- Chat ID, Request Text, Response Text
- Model Used, Response Length
- Execution Time, Error Message
- Created At (timestamp)

#### daily_limits
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –¥–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã:
- User ID, Date
- Pro Requests Count
- Flash Requests Count
- Updated At

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –≤ Supabase Dashboard:

```sql
-- –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT 
    username, 
    first_name,
    COUNT(*) as total_requests
FROM request_logs
GROUP BY username, first_name
ORDER BY total_requests DESC
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π
SELECT 
    model_used,
    COUNT(*) as count,
    AVG(execution_time_ms) as avg_time
FROM request_logs
GROUP BY model_used;
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------|----------|--------------|--------------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç BotFather | ‚úÖ | - |
| `TELEGRAM_BOT_USERNAME` | Username –±–æ—Ç–∞ (–±–µ–∑ @) | ‚úÖ | - |
| `TELEGRAM_ALLOWED_CHAT_IDS` | ID —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | ‚úÖ | - |
| `GEMINI_API_KEY` | Google Gemini API –∫–ª—é—á | ‚úÖ | - |
| `SUPABASE_URL` | URL –ø—Ä–æ–µ–∫—Ç–∞ Supabase | ‚úÖ | - |
| `SUPABASE_KEY` | Supabase API –∫–ª—é—á | ‚úÖ | - |
| `TIMEZONE` | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å | ‚ùå | `Europe/Moscow` |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | ‚ùå | `info` |
| `ENVIRONMENT` | –û–∫—Ä—É–∂–µ–Ω–∏–µ (dev/prod) | ‚ùå | `production` |
| `PRO_DAILY_LIMIT` | –õ–∏–º–∏—Ç Pro –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å | ‚ùå | `5` |
| `FLASH_DAILY_LIMIT` | –õ–∏–º–∏—Ç Flash –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å | ‚ùå | `25` |
| `GEMINI_TIMEOUT` | –¢–∞–π–º–∞—É—Ç Gemini API (—Å–µ–∫) | ‚ùå | `30` |
| `SUPABASE_TIMEOUT` | –¢–∞–π–º–∞—É—Ç Supabase (—Å–µ–∫) | ‚ùå | `10` |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ 3500 —Å–∏–º–≤–æ–ª–æ–≤ (–≤ –ø—Ä–æ–º–ø—Ç–µ) –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –ª–∏–º–∏—Ç–æ–º Telegram –≤ 4096 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ.

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ù–∏–∫–∞–∫–∏–µ credentials –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API
- ‚úÖ Graceful shutdown –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É (–∏–ª–∏ –≥—Ä—É–ø–ø—ã)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `TELEGRAM_ALLOWED_CHAT_IDS` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID —á–∞—Ç–æ–≤
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f`

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `SUPABASE_URL` –∏ `SUPABASE_KEY`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ schema.sql)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ Supabase —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–æ—Å—Ç—É–ø –ø–æ API –∫–ª—é—á—É

### –û—à–∏–±–∫–∞ Gemini API

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `GEMINI_API_KEY`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∫–≤–æ—Ç–∞ API
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –≤ –∫–æ–¥–µ (–º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)

### –õ–∏–º–∏—Ç—ã –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TIMEZONE` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è TZ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ä–∞–±–æ—Ç—ã rate limiter

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# Docker Compose
docker-compose logs -f

# Docker
docker logs -f telegram-llm-bot

# –õ–æ–∫–∞–ª—å–Ω–æ - –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ stdout
```

### –ú–µ—Ç—Ä–∏–∫–∏ –≤ Supabase

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ view `daily_statistics` –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

```sql
SELECT * FROM daily_statistics 
ORDER BY date DESC 
LIMIT 7;
```

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ .env
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üéØ TODO / –£–ª—É—á—à–µ–Ω–∏—è

- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å metrics endpoint (Prometheus)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Ç–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–ø–∏—Å–æ–∫/–ø–ª–∞—Ç–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –±–æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º –≥—Ä—É–ø–ø–æ–≤–æ–º —á–∞—Ç–µ. –î–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏.
